name: Create Release

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
        
    - name: Create spec file if not exists
      run: |
        if (-not (Test-Path "pickish.spec")) {
          Write-Host "Creating pickish.spec file..."
          python -m PyInstaller --name Pickish --onefile --windowed --hidden-import PIL._tkinter_finder photo_filter_enhanced.py
          Move-Item "Pickish.spec" "pickish.spec" -Force
        }
        
    - name: Build executable
      run: |
        python -m PyInstaller pickish.spec --clean
        
    - name: Create distribution package
      run: |
        if (-not (Test-Path "Pickish_Distribution")) {
          New-Item -ItemType Directory -Path "Pickish_Distribution" | Out-Null
        }
        Copy-Item "dist\\Pickish.exe" "Pickish_Distribution\\"
        Copy-Item "README.md" "Pickish_Distribution\\README.md"
        Copy-Item "VERSION_HISTORY.md" "Pickish_Distribution\\"
        Copy-Item "run_pickish.bat" "Pickish_Distribution\\"
        
    - name: Create ZIP archive
      run: |
        $version = "${{ github.ref_name }}"
        $version = $version.TrimStart('v')
        powershell Compress-Archive -Path "Pickish_Distribution\*" -DestinationPath "Pickish_v$version.zip" -Force
        
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          Pickish_v${{ github.ref_name }}.zip
        body: |
          ## Pickish ${{ github.ref_name }}
          
          ### üéâ What's New
          - Automated build and release from GitHub Actions
          - Standalone executable for Windows (no Python required)
          - Three-category photo filtering (Love, Like, Dislike)
          - Keyboard shortcuts for fast filtering
          - Undo support for all actions
          - Auto-rotation for vertical images
          - Background processing for smooth performance
          
          ### üì¶ Installation
          1. Download the ZIP file above
          2. Extract to any folder on your Windows computer
          3. Run `Pickish.exe` or double-click `run_pickish.bat`
          
          ### ‚å®Ô∏è Keyboard Shortcuts
          - **Left Arrow**: Skip/Dislike photo
          - **Right Arrow**: Like photo  
          - **Down Arrow**: Love photo
          - **Up Arrow**: Undo last action
          - **Space**: Like photo
          
          ### üìÅ Organization
          Photos are automatically organized into:
          - **PERFECT/** - Your absolute favorite photos (Loved)
          - **FINAL/** - Good photos you want to keep (Liked)
          - **SKIPPED/** - Photos for later review (Disliked)
          
          ### üîß System Requirements
          - Windows 10/11 (64-bit)
          - 4GB RAM minimum (8GB recommended)
          - 500MB free disk space
          
          ### üìñ Documentation
          See README.md in the ZIP file for detailed instructions.
          
          ### üêõ Issues & Support
          If you encounter any issues, please report them on the GitHub repository.
          
          ---
          
          **Enjoy organizing your photos with Pickish!** üì∏‚ú®
        draft: false
        prerelease: false
        generate_release_notes: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 